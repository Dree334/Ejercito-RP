<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Colombia Wars RP - Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --sidebar-bg: #0b1120;
            --item-active-bg: #111e3d;
            --item-hover-bg: #16223f;
            --text-main: #d1d5db;
            --text-dim: #4b5563;
            --accent-blue: #2563eb;
            --accent-yellow: #eab308;
            --accent-red: #dc2626;
            --accent-green: #22c55e;
            --icon-bg: #1e293b;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Inter', sans-serif;
        }

        body {
            display: flex;
            height: 100vh;
            background-color: #0f172a;
            color: white;
            overflow: hidden;
        }

        .sidebar {
            width: 320px;
            background-color: var(--sidebar-bg);
            display: flex;
            flex-direction: column;
            border-right: 1px solid #1e293b;
            overflow-y: auto;
        }

        .sidebar::-webkit-scrollbar { width: 5px; }
        .sidebar::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 10px; }

        .sidebar-header {
            padding: 25px 20px;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 30px;
        }

        .brand img { width: 45px; height: auto; border-radius: 4px; }
        .brand h1 { font-size: 18px; font-weight: 800; letter-spacing: 0.5px; }
        .brand p { font-size: 11px; color: var(--text-dim); text-transform: uppercase; }

        .user-status-card {
            background: linear-gradient(135deg, #1e3a8a 0%, #0b1120 100%);
            padding: 15px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            border: 1px solid #1e40af;
            margin-bottom: 20px;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            background: var(--accent-blue);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .user-info h4 { font-size: 15px; }
        .user-info p { font-size: 11px; color: #94a3b8; }

        .online-dot {
            width: 10px;
            height: 10px;
            background: var(--accent-green);
            border-radius: 50%;
            margin-left: auto;
            box-shadow: 0 0 10px var(--accent-green);
        }

        .nav-label {
            padding: 15px 25px 8px;
            font-size: 11px;
            font-weight: 700;
            color: #334155;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 10px 20px;
            text-decoration: none;
            color: #94a3b8;
            font-size: 14px;
            font-weight: 600;
            transition: 0.2s ease;
            position: relative;
            margin: 2px 10px;
            border-radius: 8px;
        }

        .nav-item:hover {
            background-color: var(--item-hover-bg);
            color: white;
        }

        .nav-item.active {
            background-color: var(--item-active-bg);
            color: white;
            border: 1px solid #1e3a8a;
        }

        .nav-item.active::before {
            content: '';
            position: absolute;
            left: -10px;
            top: 20%;
            height: 60%;
            width: 4px;
            background-color: var(--accent-yellow);
            border-radius: 0 4px 4px 0;
        }

        .icon-box {
            width: 38px;
            height: 38px;
            background-color: var(--icon-bg);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 16px;
        }

        .count-badge {
            margin-left: auto;
            font-size: 11px;
            font-weight: 800;
            padding: 2px 8px;
            border-radius: 20px;
        }

        .badge-blue { background: #1e40af; color: white; }
        .badge-red { background: var(--accent-red); color: white; }
        .badge-green { background: var(--accent-green); color: #064e3b; font-size: 9px; }

        .sidebar-footer {
            margin-top: auto;
            padding: 20px 0;
            border-top: 1px solid #1e293b;
        }

        .content {
            flex: 1;
            padding: 40px;
            background: radial-gradient(circle at top right, #111827, #020617);
            overflow-y: auto;
        }

        /* --- ESTILOS AGREGADOS --- */
        .grid-usuarios {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .card-soldado {
            background: #111e3d;
            border: 1px solid #1e3a8a;
            padding: 15px;
            border-radius: 12px;
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .card-soldado:hover { background: #16223f; transform: translateY(-3px); border-color: var(--accent-yellow); }
        
        #modal-perfil {
            display: none;
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); backdrop-filter: blur(5px);
            z-index: 1000; align-items: center; justify-content: center;
        }
        .modal-body {
            background: #1e293b; width: 400px; padding: 30px; border-radius: 15px;
            border: 1px solid #334155; position: relative; text-align: center;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body>

    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="brand">
                <img src="https://upload.wikimedia.org/wikipedia/commons/2/21/Flag_of_Colombia.svg" alt="Col">
                <div>
                    <h1>COLOMBIA WARS RP</h1>
                    <p>GTA SA ‚Ä¢ MTA ‚Ä¢ Guerras Mundiales</p>
                </div>
            </div>

            <div class="user-status-card">
                <div class="user-avatar"><i class="fas fa-helmet-battle"></i></div>
                <div class="user-info">
                    <h4>Operador Activo</h4>
                    <p>// BANDO COLOMBIA</p>
                </div>
                <div class="online-dot"></div>
            </div>
        </div>

        <div class="nav-label">// Men√∫ Principal</div>
        <a href="index.html" class="nav-item">
            <div class="icon-box"><i class="fas fa-home" style="color: #f59e0b;"></i></div>
            PANEL DE MANDO
        </a>
        <a href="index3.html" class="nav-item active">
            <div class="icon-box"><i class="fas fa-id-badge"></i></div>
            PERSONAL RP
            <span class="count-badge badge-blue" id="contador-total">0</span>
        </a>
        <a href="FuerzaAE.html" class="nav-item">
            <div class="icon-box"><i class="fas fa-plane"></i></div>
            PILOTOS DE FACCI√ìN
        </a>
        <a href="FE.html" class="nav-item">
            <div class="icon-box"><i class="fas fa-bolt" style="color: #f87171;"></i></div>
            CNOE ‚Äî OPS. ESPECIALES
            <span class="count-badge badge-red">3</span>
        </a>

        
        <a href="Codigos.html" class="nav-item">
            <div class="icon-box"><i class="fas fa-satellite-dish"></i></div>
            FRECUENCIAS Y C√ìDIGOS
        </a>
        <a href="mapa_tactico.html" class="nav-item">
            <div class="icon-box"><i class="fas fa-bullseye" style="color: #ec4899;"></i></div>
            RADAR DE MISI√ìN
        </a>

        <div class="nav-label">// Administraci√≥n</div>
        <a href="Incorporacion.html" class="nav-item">
            <div class="icon-box"><i class="fas fa-inbox"></i></div>
            CONVOCATORIAS
            <span class="count-badge badge-green">NEW</span>
        </a>
        <a href="PanelAdm.html" class="nav-item">
            <div class="icon-box"><i class="fas fa-cog"></i></div>
            ADMINISTRATIVO
        </a>
        <a href="Rangos.html" class="nav-item">
            <div class="icon-box"><i class="fas fa-trophy" style="color: #fbbf24;"></i></div>
            JERARQU√çA MILITAR
        </a>

        <div class="sidebar-footer">
            <a href="index.html" class="nav-item">
                <div class="icon-box"><i class="fas fa-arrow-left"></i></div>
                VOLVER AL INICIO
            </a>
            <a href="ReglaInterna.html" class="nav-item">
                <div class="icon-box"><i class="fas fa-file-alt"></i></div>
                REGLAMENTO
            </a>
            <a href="https://discord.gg/NbzkaAjm" target="_blank" class="nav-item">
                <div class="icon-box"><i class="fab fa-discord"></i></div>
                DISCORD
            </a>
        </div>
    </aside>

    <main class="content">
        <h1 style="font-size: 32px; color: white; margin-bottom: 10px;">CENTRAL DE PERSONAL</h1>
        <p style="color: #64748b; margin-bottom: 30px;">Selecciona una ficha para ver el expediente del soldado.</p>

        <div id="contenedor-usuarios" class="grid-usuarios">
            <p id="msg-carga" style="color: #4b5563; font-family: monospace;">SINCRONIZANDO CON COMANDO CENTRAL...</p>
        </div>
    </main>

    <div id="modal-perfil">
        <div class="modal-body">
            <button onclick="cerrarPerfil()" style="position: absolute; top: 15px; right: 15px; background: none; border: none; color: #64748b; cursor: pointer; font-size: 18px;"><i class="fas fa-times"></i></button>
            <div style="font-size: 60px; color: var(--accent-blue); margin-bottom: 15px;"><i class="fas fa-user-shield"></i></div>
            <h2 id="p-nombre" style="text-transform: uppercase; letter-spacing: 1px;">NOMBRE</h2>
            <p id="p-rango" style="color: var(--accent-yellow); font-weight: 800; margin-bottom: 25px; font-size: 14px; letter-spacing: 2px;">RANGO</p>
            
            <div style="background: #0f172a; padding: 20px; border-radius: 12px; text-align: left; font-size: 13px; border: 1px solid #1e293b;">
                <p style="margin-bottom: 8px; color: #64748b;">üÜî PLACA: <span id="p-placa" style="float: right; color: white; font-family: monospace;"></span></p>
                <p style="margin-bottom: 8px; color: #64748b;">üåç PA√çS: <span id="p-pais" style="float: right; color: white;"></span></p>
                <p style="margin-bottom: 8px; color: #64748b;">üéÇ EDAD: <span id="p-edad" style="float: right; color: white;"></span></p>
                <p style="color: #64748b;">üéÆ DISCORD: <span id="p-discord" style="float: right; color: white;"></span></p>
            </div>
            
            <div style="margin-top: 20px; font-size: 10px; color: #4b5563; font-weight: 700; text-transform: uppercase;">
                Expediente Militar Oficial - Colombia Wars RP
            </div>
        </div>
    </div>

    <script>
        // FUNCI√ìN AGREGADA PARA CONEXI√ìN REAL CON GITHUB/CLOUDFLARE
        async function cargarSoldados() {
            const contenedor = document.getElementById('contenedor-usuarios');
            const msgCarga = document.getElementById('msg-carga');

            try {
                // Ajustado para llamar a tu carpeta de functions
                const res = await fetch('/api/personal'); 
                const soldados = await res.json();
                
                if (soldados.length > 0) {
                    contenedor.innerHTML = ""; // Limpiar mensaje de carga
                    document.getElementById('contador-total').innerText = soldados.length;

                    soldados.forEach(s => {
                        const card = document.createElement('div');
                        card.className = 'card-soldado';
                        
                        // Si la placa contiene CDT, le damos un toque cian (Piloto)
                        const iconColor = s.placa?.includes('CDT') ? 'var(--accent-green)' : 'var(--accent-blue)';
                        
                        card.onclick = () => abrirPerfil(s);
                        card.innerHTML = `
                            <div style="font-size: 20px; color: ${iconColor};"><i class="fas fa-id-card"></i></div>
                            <div>
                                <div style="font-weight: 700; font-size: 14px; color: white;">${s.nombre_ic}</div>
                                <div style="font-size: 11px; color: #64748b;">${s.rango} ‚Ä¢ ${s.placa}</div>
                            </div>
                        `;
                        contenedor.appendChild(card);
                    });
                } else {
                    msgCarga.innerText = "NO SE ENCONTR√ì PERSONAL REGISTRADO.";
                }
            } catch (e) { 
                console.error("Error al cargar base de datos:", e);
                msgCarga.innerText = "ERROR DE CONEXI√ìN SATELITAL CON D1.";
            }
        }

        function abrirPerfil(s) {
            document.getElementById('p-nombre').innerText = s.nombre_ic;
            document.getElementById('p-rango').innerText = (s.rango || "SIN RANGO").toUpperCase();
            document.getElementById('p-placa').innerText = s.placa || "N/A";
            document.getElementById('p-pais').innerText = s.pais || "Colombia";
            document.getElementById('p-edad').innerText = (s.edad || "??") + " A√±os";
            document.getElementById('p-discord').innerText = s.nombre_discord || s.discord || 'N/A';
            document.getElementById('modal-perfil').style.display = 'flex';
        }

        function cerrarPerfil() { document.getElementById('modal-perfil').style.display = 'none'; }

        // Cerrar modal si se hace clic fuera de √©l
        window.onclick = function(event) {
            const modal = document.getElementById('modal-perfil');
            if (event.target == modal) { cerrarPerfil(); }
        }

        // Carga inicial
        document.addEventListener('DOMContentLoaded', cargarSoldados);
    </script>
</body>
</html>
