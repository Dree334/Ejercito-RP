<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Colombia Wars RP - Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --sidebar-bg: #0b1120;
            --item-active-bg: #111e3d;
            --item-hover-bg: #16223f;
            --text-main: #d1d5db;
            --text-dim: #4b5563;
            --accent-blue: #2563eb;
            --accent-yellow: #eab308;
            --accent-red: #dc2626;
            --accent-green: #22c55e;
            --icon-bg: #1e293b;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; }

        body {
            display: flex;
            height: 100vh;
            background-color: #0f172a;
            color: white;
            overflow: hidden;
        }

        /* SIDEBAR */
        .sidebar {
            width: 320px;
            background-color: var(--sidebar-bg);
            display: flex;
            flex-direction: column;
            border-right: 1px solid #1e293b;
            overflow-y: auto;
        }

        .sidebar::-webkit-scrollbar { width: 5px; }
        .sidebar::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 10px; }

        .sidebar-header { padding: 25px 20px; }
        .brand { display: flex; align-items: center; gap: 12px; margin-bottom: 30px; }
        .brand img { width: 45px; height: auto; border-radius: 4px; }
        .brand h1 { font-size: 18px; font-weight: 800; letter-spacing: 0.5px; }
        .brand p { font-size: 11px; color: var(--text-dim); text-transform: uppercase; }

        .user-status-card {
            background: linear-gradient(135deg, #1e3a8a 0%, #0b1120 100%);
            padding: 15px; border-radius: 12px; display: flex; align-items: center; gap: 12px;
            border: 1px solid #1e40af; margin-bottom: 20px;
        }

        .user-avatar { width: 45px; height: 45px; background: var(--accent-blue); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        
        /* NAVEGACIÓN */
        .nav-label { padding: 15px 25px 8px; font-size: 11px; font-weight: 700; color: #334155; text-transform: uppercase; letter-spacing: 1px; }

        .nav-item {
            display: flex; align-items: center; padding: 10px 20px; text-decoration: none;
            color: #94a3b8; font-size: 14px; font-weight: 600; transition: 0.2s ease;
            position: relative; margin: 2px 10px; border-radius: 8px;
        }

        .nav-item:hover, .nav-item.active { background-color: var(--item-hover-bg); color: white; }
        .nav-item.active { background-color: var(--item-active-bg); border: 1px solid #1e3a8a; }

        .icon-box { width: 38px; height: 38px; background-color: var(--icon-bg); border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-right: 15px; font-size: 16px; }

        .count-badge { margin-left: auto; font-size: 11px; font-weight: 800; padding: 2px 8px; border-radius: 20px; }
        .badge-blue { background: #1e40af; color: white; }
        .badge-red { background: var(--accent-red); color: white; }
        .badge-green { background: var(--accent-green); color: #064e3b; font-size: 9px; }

        /* CONTENIDO */
        .content { flex: 1; padding: 40px; background: radial-gradient(circle at top right, #111827, #020617); overflow-y: auto; }

        .tactical-box {
            background: rgba(11, 17, 32, 0.5);
            border: 1px solid #1e293b;
            border-radius: 8px;
            padding: 25px;
            margin-top: 20px;
        }

        .log-entry {
            display: flex; gap: 15px; padding: 12px;
            border-left: 3px solid var(--accent-blue);
            background: rgba(255,255,255,0.02);
            margin-bottom: 10px;
            border-radius: 0 4px 4px 0;
        }
    </style>
</head>
<body>

    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="brand">
                <img src="https://upload.wikimedia.org/wikipedia/commons/2/21/Flag_of_Colombia.svg" alt="Col">
                <div>
                    <h1>COLOMBIA WARS RP</h1>
                    <p>GTA SA • MTA • Guerras Mundiales</p>
                </div>
            </div>

            <div class="user-status-card">
                <div class="user-avatar"><i class="fas fa-helmet-battle"></i></div>
                <div class="user-info">
                    <h4>Operador Activo</h4>
                    <p>// BANDO COLOMBIA</p>
                </div>
                <div style="width: 10px; height: 10px; background: var(--accent-green); border-radius: 50%; margin-left: auto; box-shadow: 0 0 10px var(--accent-green);"></div>
            </div>
        </div>

        <div class="nav-label">// Menú Principal</div>
        <a href="index1.html" class="nav-item active">
            <div class="icon-box"><i class="fas fa-home" style="color: #f59e0b;"></i></div>
            PANEL DE MANDO
        </a>
        <a href="index3.html" class="nav-item">
            <div class="icon-box"><i class="fas fa-id-badge"></i></div>
            PERSONAL RP
            <span class="count-badge badge-blue">DB</span>
        </a>
        <a href="gestion_pilotos.html" class="nav-item">
            <div class="icon-box"><i class="fas fa-plane"></i></div>
            PILOTOS DE FACCIÓN
        </a>
        <a href="FE.html" class="nav-item">
            <div class="icon-box"><i class="fas fa-bolt" style="color: #f87171;"></i></div>
            CNOE — OPS. ESPECIALES
            <span class="count-badge badge-red">3</span>
        </a>

        <a href="Codigos.html" class="nav-item">
            <div class="icon-box"><i class="fas fa-satellite-dish"></i></div>
            FRECUENCIAS Y CÓDIGOS
        </a>
        <a href="mapa_tactico.html" class="nav-item">
            <div class="icon-box"><i class="fas fa-bullseye" style="color: #ec4899;"></i></div>
            RADAR DE MISIÓN
        </a>

        <div class="nav-label">// Administración</div>
        <a href="Incorporacion.html" class="nav-item">
            <div class="icon-box"><i class="fas fa-inbox"></i></div>
            CONVOCATORIAS
            <span class="count-badge badge-green">NEW</span>
        </a>
        <a href="PanelAdm.html" class="nav-item">
            <div class="icon-box"><i class="fas fa-cog"></i></div>
            ADMINISTRATIVO
        </a>
        <a href="Rangos.html" class="nav-item">
            <div class="icon-box"><i class="fas fa-trophy" style="color: #fbbf24;"></i></div>
            JERARQUÍA MILITAR
        </a>

        <div style="margin-top: auto; padding: 20px 0; border-top: 1px solid #1e293b;">
            <a href="ReglaInterna.html" class="nav-item">
                <div class="icon-box"><i class="fas fa-file-alt"></i></div>
                REGLAMENTO
            </a>
            <a href="https://discord.gg/NbzkaAjm" target="_blank" class="nav-item">
                <div class="icon-box"><i class="fab fa-discord"></i></div>
                DISCORD
            </a>
        </div>
    </aside>

    <main class="content">
        <h2 style="font-size: 28px; font-weight: 800; margin-bottom: 5px;">PANEL DE <span style="color: var(--accent-yellow);">CONTROL</span></h2>
        <p style="color: #64748b; font-size: 11px; text-transform: uppercase; margin-bottom: 30px;">Sincronización directa con base de datos militar</p>

        <div class="tactical-box">
            <div style="display: flex; justify-content: space-between; border-bottom: 1px solid #1e293b; padding-bottom: 15px; margin-bottom: 20px;">
                <h3 style="font-size: 11px; color: var(--accent-yellow); letter-spacing: 2px;">REGISTRO TÁCTICO EN VIVO</h3>
                <span id="status-link" style="color: var(--accent-green); font-family: monospace; font-size: 12px;"><i class="fas fa-link"></i> EN LINEA</span>
            </div>

            <div id="feed-principal">
                <p style="color: #4b5563; font-family: monospace; font-size: 12px;">ESPERANDO DATOS DE FUNCTION/DASHBOARD_GLOBAL...</p>
            </div>
        </div>
    </main>

    <script>
        async function actualizarFeed() {
            const feed = document.getElementById('feed-principal');
            try {
                // RUTA CORREGIDA: Apunta a /dashboard_global que es el archivo en functions/
                const res = await fetch('/dashboard_global');
                const data = await res.json();
                
                if(data && data.length > 0) {
                    feed.innerHTML = "";
                    data.forEach(log => {
                        let config = { color: "var(--accent-blue)", icon: "fa-user-shield" };
                        
                        // Si es piloto (placa CDT), color verde. Si es sanción, rojo.
                        if(log.placa?.includes('CDT')) { config = { color: "var(--accent-green)", icon: "fa-plane" }; }
                        if(log.tipo === 'sancion') { config = { color: "var(--accent-red)", icon: "fa-gavel" }; }

                        feed.innerHTML += `
                            <div class="log-entry" style="border-left-color: ${config.color}">
                                <div style="color: ${config.color}; font-size: 18px; padding-left: 5px;"><i class="fas ${config.icon}"></i></div>
                                <div style="flex: 1;">
                                    <div style="display: flex; justify-content: space-between;">
                                        <span style="font-weight: 800; font-size: 13px;">${log.nombre_ic} <span style="color: #4b5563; font-weight: 400;">[${log.rango}]</span></span>
                                        <span style="font-size: 10px; color: #4b5563;">SISTEMA D1</span>
                                    </div>
                                    <p style="font-size: 11px; color: #94a3b8; margin-top: 4px;">Placa: ${log.placa} • Estado: Activo en sistema.</p>
                                </div>
                            </div>
                        `;
                    });
                }
            } catch (e) {
                console.error("Error cargando de functions:", e);
                feed.innerHTML = "<p style='color: var(--accent-red); font-size: 11px;'>ERROR: No se pudo contactar con function/dashboard_global</p>";
            }
        }

        document.addEventListener('DOMContentLoaded', actualizarFeed);
        // Actualiza cada 30 segundos
        setInterval(actualizarFeed, 30000);
    </script>
</body>
</html>
