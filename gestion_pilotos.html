<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>S.U.K.V. - Aviaci√≥n Militar</title>
    <style>
        :root { --primary: #00d4ff; --bg: #0b0f19; --card: #161b22; --border: #30363d; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; padding: 20px; }
        .panel { background: var(--card); border: 1px solid var(--border); padding: 25px; border-radius: 8px; border-left: 5px solid var(--primary); box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 20px; }
        input { padding: 12px; background: #0d1117; border: 1px solid var(--border); color: white; border-radius: 4px; outline: none; }
        input:focus { border-color: var(--primary); }
        button { padding: 15px; background: var(--primary); color: black; border: none; font-weight: bold; cursor: pointer; border-radius: 4px; text-transform: uppercase; transition: 0.3s; }
        button:hover { background: #008fb3; transform: scale(1.02); }
        table { width: 100%; border-collapse: collapse; margin-top: 25px; background: var(--card); border-radius: 8px; overflow: hidden; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid var(--border); }
        th { color: var(--primary); background: #1c2128; font-size: 0.85rem; text-transform: uppercase; }
        .placa-badge { color: #00d4ff; font-family: 'Courier New', monospace; font-weight: bold; background: rgba(0, 212, 255, 0.1); padding: 4px 8px; border-radius: 4px; }
    </style>
</head>
<body>

    <div class="panel">
        <h2 style="margin-top:0;">ü¶Ö COMANDO DE AVIACI√ìN MILITAR</h2>
        <p style="color: #8b949e; margin-bottom: 20px;">Registro Oficial de Pilotos - S.U.K.V.</p>
        <div class="grid">
            <input type="text" id="nombre_ic" placeholder="Nombre IC (Ej: Sam Sukv)">
            <input type="number" id="edad" placeholder="Edad" value="20">
            <input type="text" id="pais" placeholder="Pa√≠s" value="Colombia">
            <input type="text" id="discord" placeholder="Usuario de Discord">
        </div>
        <button onclick="registrarPiloto()">REGISTRAR Y GENERAR REPORTE</button>
    </div>

    <table>
        <thead>
            <tr>
                <th>PILOTO</th>
                <th>RANGO</th>
                <th>INDICATIVO</th>
                <th>PA√çS</th>
                <th>FECHA INGRESO</th>
            </tr>
        </thead>
        <tbody id="lista-pilotos"></tbody>
    </table>

    <script>
        const WEBHOOK = "https://discord.com/api/webhooks/1476777629355999404/F_xJlgg52JDIGIJlBOATF3KwM8cu4jAOR9TO-ECeaW6bp1132om0N_pVemZ3xD6rIQZl";
        const API_URL = "/pilotos"; 

        async function registrarPiloto() {
            const nombre = document.getElementById('nombre_ic').value.trim();
            const edad = document.getElementById('edad').value;
            const pais = document.getElementById('pais').value;
            const discord = document.getElementById('discord').value;

            if(!nombre || !discord) return alert("Error: El nombre y Discord son obligatorios.");

            // 1. Obtener pilotos para calcular la placa CDT-010+
            const res = await fetch(API_URL);
            const data = await res.json();
            
            let maxNum = 9;
            data.forEach(p => {
                if (p.placa && p.placa.startsWith("CDT-")) {
                    let num = parseInt(p.placa.split("-")[1]);
                    if (!isNaN(num) && num > maxNum) maxNum = num;
                }
            });
            const placaGenerada = "CDT-" + String(maxNum + 1).padStart(3, '0');

            // 2. Preparar datos completos para la tabla
            const ahora = new Date();
            const fechaSql = ahora.toISOString().slice(0, 10) + " " + ahora.toLocaleTimeString('it-IT');

            const payload = {
                correo: `piloto_${Date.now()}@sukv.com`,
                password: "123",
                nombre_discord: discord,
                nombre_ic: nombre,
                edad: parseInt(edad),
                pais: pais,
                rango: "Aspirante",
                placa: placaGenerada,
                fecha_registro: fechaSql,
                division: "Aviaci√≥n"
            };

            // 3. Guardar en DB
            const response = await fetch(API_URL, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(payload)
            });

            if(response.ok) {
                // 4. Enviar a Discord con TU DISE√ëO
                const msgDiscord = {
                    content: `ùêÄùêïùêàùêÄùêÇùêàÃÅùêéùêç ùêåùêàùêãùêàùêìùêÄùêë \n‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ú¶‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó\n  ùêéùêÖùêàùêÇùêàùêÄùêã: „Äå ${nombre} „Äç\n  ùêèùêãùêÄùêÇùêÄ: / ${placaGenerada}\n  ùêëùêÄùêçùêÜùêé: „Äå Aspirante „Äç\n  ùêëùêéùêã: Piloto F-16\n  ùêîùêçùêàùêÉùêÄùêÉ: Aviaci√≥n Militar\n‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ú¶‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\nHonor ‚Ä¢ Disciplina ‚Ä¢ Lealtad\nForjando alas para la patria`
                };

                await fetch(WEBHOOK, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(msgDiscord)
                });

                alert(`‚úÖ Piloto ${nombre} registrado como ${placaGenerada}`);
                location.reload(); 
            }
        }

        window.onload = async () => {
            const res = await fetch(API_URL);
            const datos = await res.json();
            const lista = document.getElementById('lista-pilotos');
                datos.forEach(p => {
                    lista.innerHTML += `<tr>
                        <td><b>${p.nombre_ic}</b><br><small style="color:#8b949e">${p.nombre_discord}</small></td>
                        <td>${p.rango}</td>
                        <td><span class="placa-badge">${p.placa}</span></td>
                        <td>${p.pais}</td>
                        <td><small>${p.fecha_registro}</small></td>
                    </tr>`;
                });
        };
    </script>
</body>
</html>
