<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>S.U.K.V. V4.0 - Gestión de Sanciones</title>
</head>
<body style="background-color: #020814; color: white; font-family: sans-serif;">

    <h1>SISTEMA DE SANCIONES S.U.K.V.</h1>

    <div style="border: 1px solid #1a2a44; padding: 20px; width: 300px;">
        <input type="text" id="nombre_ic" placeholder="NOMBRE IC DEL SOLDADO">
        <input type="text" id="placa" placeholder="PLACA MILITAR">
        <input type="text" id="discord" placeholder="ID DISCORD">
        <textarea id="motivo" placeholder="MOTIVO DEL REPORTE"></textarea>
        <button onclick="ejecutarSancion()">EJECUTAR PROTOCOLO</button>
    </div>

    <hr>

    <table border="1" style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr>
                <th>SOLDADO</th>
                <th>PLACAS</th>
                <th>NIVEL</th>
                <th>FECHA</th>
            </tr>
        </thead>
        <tbody id="tabla-registros">
            </tbody>
    </table>

    <script>
        async function ejecutarSancion() {
            const payload = {
                nombre_ic: document.getElementById('nombre_ic').value,
                placa: document.getElementById('placa').value,
                discord: document.getElementById('discord').value,
                nivel: 3, // Puedes hacerlo dinámico luego
                motivo: document.getElementById('motivo').value,
                fecha: new Date().toLocaleDateString('es-CO')
            };

            try {
                const res = await fetch('/api/sancionar', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (res.ok) {
                    alert("✅ REGISTRADO");
                    cargarRegistros();
                } else {
                    const err = await res.json();
                    alert("❌ ERROR: " + err.error);
                }
            } catch (e) {
                alert("❌ Fallo de conexión.");
            }
        }

        async function cargarRegistros() {
            try {
                const res = await fetch('/api/sancionar');
                const datos = await res.json();
                const tabla = document.getElementById('tabla-registros');
                
                tabla.innerHTML = "";
                datos.forEach(s => {
                    tabla.innerHTML += `
                        <tr>
                            <td>${s.nombre_ic}</td>
                            <td>${s.placa}</td>
                            <td>STRIKE ${s.nivel}</td>
                            <td>${s.fecha}</td>
                        </tr>`;
                });
            } catch (e) {
                console.error("Error al sincronizar tabla.");
            }
        }

        document.addEventListener('DOMContentLoaded', cargarRegistros);
    </script>
</body>
</html>
